"use strict";var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var webPush=require("web-push");exports.sendPushNotification=function(e,i){(i=i||{}).message=i.message?i.message:"Test Message ",i.clickTarget=i.clickTarget?i.clickTarget:"http://visualbi.com",i.title=i.title?i.title:"APS Tool";var t=(0,_stringify2.default)(i);webPush.sendNotification(e,t,{}).then(function(e){console.log("Status : "+util.inspect(e.statusCode)),console.log("Headers : "+(0,_stringify2.default)(e.headers)),console.log("Body : "+(0,_stringify2.default)(e.body))}).catch(function(e){console.log(e),console.log("Status : "+util.inspect(e.statusCode)),console.log("Headers : "+(0,_stringify2.default)(e.headers)),console.log("Body : "+(0,_stringify2.default)(e.body))})},exports.notifyAdmins=function(e,i){(e=e.db("vbx_current")).collection("users").find({isAdmin:!0}).each(function(t,o){o&&(console.log(o._id),e.collection("subscription").find({email:o._id}).each(function(e,t){if(t){console.log(t);var o={endpoint:t._id,keys:{p256dh:t.publicKey,auth:t.auth}};exports.sendPushNotification(o,i)}}))})},exports.notifyUser=function(e,i,t){(e=e.db("vbx_current")).collection("subscription").find({email:i}).each(function(e,i){if(i){var o={endpoint:i._id,keys:{p256dh:i.publicKey,auth:i.auth}};exports.sendPushNotification(o,t)}})};