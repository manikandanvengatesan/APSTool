"use strict";var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var webPush=require("web-push");exports.sendPushNotification=function(e,i){(i=i||{}).message=i.message?i.message:"Test Message ",i.clickTarget=i.clickTarget?i.clickTarget:"http://visualbi.com",i.title=i.title?i.title:"APS Tool";var t=(0,_stringify2.default)(i);webPush.sendNotification(e,t,{}).then(function(e){console.log("Status : "+util.inspect(e.statusCode)),console.log("Headers : "+(0,_stringify2.default)(e.headers)),console.log("Body : "+(0,_stringify2.default)(e.body))}).catch(function(e){console.log(e),console.log("Status : "+util.inspect(e.statusCode)),console.log("Headers : "+(0,_stringify2.default)(e.headers)),console.log("Body : "+(0,_stringify2.default)(e.body))})},exports.notifyAdmins=function(t,o){(t=t.db("vbx_current")).collection("users").find({isAdmin:!0}).each(function(e,i){i&&(console.log(i._id),t.collection("subscription").find({email:i._id}).each(function(e,i){if(i){console.log(i);var t={endpoint:i._id,keys:{p256dh:i.publicKey,auth:i.auth}};exports.sendPushNotification(t,o)}}))})},exports.notifyUser=function(e,i,o){(e=e.db("vbx_current")).collection("subscription").find({email:i}).each(function(e,i){if(i){var t={endpoint:i._id,keys:{p256dh:i.publicKey,auth:i.auth}};exports.sendPushNotification(t,o)}})};