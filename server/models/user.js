"use strict";var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var loginLib=require("../lib/login");exports.createUser=function(e){var r=e.db;return new _promise2.default(function(t,n){e.data.password=loginLib.generatePassword(e.data.password),r.collection("users").insertOne(e.data,function(e,r){return e?n(e):t(r)})})},exports.deleteUser=function(e){var r=e.db;return new _promise2.default(function(t,n){r.collection("users").deleteOne(e.data,function(e,r){return e?n(e):t(r)})})},exports.updateUser=function(e){var r=e.db;return e.data.password&&(e.data.password=loginLib.generatePassword(e.data.password)),new _promise2.default(function(t,n){r.collection("users").updateOne(e.data,{$set:e.filter},function(e,r){return e?n(e):t(r)})})},exports.updatePassword=function(e){var r=e.db;return e.data.password&&(e.data.password=loginLib.generatePassword(e.data.password)),new _promise2.default(function(t,n){r.collection("users").updateOne(e.filter,{$set:e.data},function(e,r){return e?n(e):t(r)})})},exports.login=function(e){var r=e.db;return e.data.password=loginLib.generatePassword(e.data.password),new _promise2.default(function(t,n){r.collection("users").findOne(e.data,{password:0},function(e,r){if(e)return n(e);if(!r)return n({code:401});var a={_id:r._id,user:r.username};return a.scope=r.isAdmin?["ADMIN"]:["USER"],loginLib.generateToken(a).then(function(e){t({token:e,data:r})})})})};