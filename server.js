"use strict";var Hapi=require("hapi"),Boom=require("boom"),config=require("config"),hapiJWT=require("hapi-auth-jwt2"),routes=require("./server/routes"),HapiMongo=require("hapi-mongodb"),inert=require("inert"),Path=require("path"),webPush=require("web-push"),server=new Hapi.Server;process.env.NODE_TLS_REJECT_UNAUTHORIZED="0";var settings={dbConfig:{url:"mongodb://"+process.env.dbUser+":"+process.env.dbPassword+"@"+process.env.dbHost+":"+process.env.dbPort+"/"+process.env.dbName,settings:{poolSize:10},decorate:!0},serverConfig:{host:process.env.serverHost,port:process.env.PORT||process.env.serverPort}},plugins=[{register:HapiMongo,options:settings.dbConfig},hapiJWT,inert],validate=function(e,r,s){return s(void 0,!0)},errorFun=function(e){return e.message="TOKEN_ERROR",e};server.connection({host:settings.serverConfig.host,port:settings.serverConfig.port,routes:{cors:!0}});var VAPID_SUBJECT="http://"+settings.serverConfig.host+":"+settings.serverConfig.port;webPush.setVapidDetails(VAPID_SUBJECT,config.get("webPush.publicKey"),config.get("webPush.privateKey")),server.register(plugins,function(e){if(e)throw console.error(e),e;server.auth.strategy("token","jwt",{key:config.get("jwt.secretKey"),validateFunc:validate,errorFunc:errorFun,verifyOptions:{algorithms:config.get("jwt.alg")}}),server.route(routes),server.start(function(){console.log("Server started at "+server.info.uri)})}),webPush.setVapidDetails(server.info.uri,config.get("webPush.publicKey"),config.get("webPush.privateKey"));