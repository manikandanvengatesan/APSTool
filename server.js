"use strict";var Hapi=require("hapi"),Boom=require("boom"),config=require("config"),hapiJWT=require("hapi-auth-jwt2"),routes=require("./server/routes"),HapiMongo=require("hapi-mongodb"),inert=require("inert"),Path=require("path"),webPush=require("web-push"),server=new Hapi.Server;process.env.NODE_TLS_REJECT_UNAUTHORIZED="0";var plugins=[{register:HapiMongo,options:config.get("dbConfig")},hapiJWT,inert],validate=function(e,r,i){return i(void 0,!0)},errorFun=function(e){return e.message="TOKEN_ERROR",e};server.connection({host:config.get("serverConfig.host"),port:config.get("serverConfig.port"),routes:{cors:!0}});var VAPID_SUBJECT="http://"+config.get("serverConfig.host")+":"+config.get("serverConfig.port");webPush.setVapidDetails(VAPID_SUBJECT,config.get("webPush.publicKey"),config.get("webPush.privateKey")),server.register(plugins,function(e){if(e)throw console.error(e),e;server.auth.strategy("token","jwt",{key:config.get("jwt.secretKey"),validateFunc:validate,errorFunc:errorFun,verifyOptions:{algorithms:config.get("jwt.alg")}}),server.route(routes),server.start(function(){console.log("Server started at "+server.info.uri)})}),webPush.setVapidDetails(server.info.uri,config.get("webPush.publicKey"),config.get("webPush.privateKey"));